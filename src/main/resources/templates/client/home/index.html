<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lowtech Store â€“ Shop bÃ¡n Ä‘á»“ thá»ƒ thao sá»‘ 1 Itis</title>
   
    <link th:href="@{/client/css/home/index.css}" rel="stylesheet" />
  </head>
 
  <body>
    <div class="topbar">
      Miá»…n phÃ­ váº­n chuyá»ƒn Ä‘Æ¡n tá»« 599k â€¢ Äá»•i size trong 7 ngÃ y â€¢ Hotline: 0988 888 888
    </div>
    <header>
      <div class="header-inner">
        <a class="logo" href="#" aria-label="Trang chá»§" 
   style="display: flex; align-items: center; text-decoration: none;">
    
          <img th:src="@{/client/images/logo.png}" 
              alt="Lowtech Store Logo" 
              style="height: 40px; 
                      width: 40px; /* ThÃªm width Ä‘á»ƒ áº£nh vuÃ´ng váº¯n trÆ°á»›c khi bo trÃ²n */
                      border-radius: 50%; /* ÄÃ¢y lÃ  code lÃ m trÃ²n áº£nh */
                      object-fit: cover; /* GiÃºp áº£nh khÃ´ng bá»‹ mÃ©o */
                      " />
          
          <span style="font-size: 16px; font-weight: bold; margin-left: 10px; color: #000;">
              Lowtech Store
          </span>
          

      </a>
        <div class="search" role="search">
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          <input
            id="searchInput"
            placeholder="TÃ¬m giÃ y, Ã¡o Ä‘áº¥u, phá»¥ kiá»‡nâ€¦ (vÃ­ dá»¥: futsal, mercurial)"
          />
          <button class="btn-primary" id="searchBtn">TÃ¬m</button>
        </div>
        <div class="header-actions">
          <div class="hotline">ğŸ“ 0988 888 888</div>
          <button class="icon-btn" id="openCart" aria-label="Má»Ÿ giá» hÃ ng">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path
                d="M1 1h4l2.68 12.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
              ></path>
            </svg>
            <span id="cartCount">0</span>
          </button>
          <div id="loginBtn" class="login-icon">
            <img
              src="https://th.bing.com/th/id/R.f58bd7f73934e1145c97570943087ec6?rik=41HmRGohn%2fnBJg&riu=http%3a%2f%2fwww.acsoft.vn%3a8081%2fresources%2fimages%2favatar.jpg&ehk=4oftGWjeo8XsGu%2fcHG2dUJubsKryVLuNa58H9D3TNKA%3d&risl=&pid=ImgRaw&r=0"
              alt="user"
            />
            <span class="notify-dot"></span>
          </div>
        </div>
      </div>
      <nav class="nav" aria-label="Danh má»¥c">
        <div class="nav-inner">
          
          <div class="dropdown">
              <a href="#" id="tatCaBtn">Táº¤T Cáº¢</a>
              <ul id="tatCaList" class="dropdown-content"></ul>
          </div>
          <div class="dropdown">
              <a href="#" id="thuongHieuBtn">THÆ¯Æ NG HIá»†U</a>
              <ul id="thuongHieuList" class="dropdown-content"></ul>
          </div>

          <div class="dropdown">
              <a href="#" id="monTheThaoBtn">MÃ”N THá»‚ THAO</a>
              <ul id="monTheThaoList" class="dropdown-content"></ul>
          </div>
          <a href="#" data-filter="ao">NAM</a>
          <a href="#" data-filter="bong">Ná»®</a>
          <a href="#" data-filter="phukien">Phá»¥ kiá»‡n</a>
          <a href="#" data-filter="sale">Sale</a>
          <a href="#" data-filter="moi">HÃ ng má»›i</a>
        </div>
      </nav>
    </header>
  
    <section class="hero" id="heroSection" aria-label="Khuyáº¿n mÃ£i ná»•i báº­t">
      <div class="banner" id="banner">
        <div class="slides">
          <div
            class="slide"
            style="
              background: linear-gradient(120deg, #6485d9 0%, #6485d9 100%);
            "
          >
            <div>
              <h2>SIÃŠU SALE FUTSAL â€¢ GIáº¢M Äáº¾N 50%</h2>
              <p>Chá»‰ trong tuáº§n nÃ y â€“ Ä‘áº·t nhanh káº»o háº¿t size!</p>
            </div>
          </div>
          <div
            class="slide"
            style="
              background: linear-gradient(120deg, #6485d9 0%, #6485d9 100%);
            "
          >
            <div>
              <h2>ÃO Äáº¤U MÃ™A Má»šI 2025</h2>
              <p>Äáº§y Ä‘á»§ CLB hot: MU, Real, Barca, Cityâ€¦</p>
            </div>
          </div>
          <div
            class="slide"
            style="
              background: linear-gradient(120deg, #6485d9 0%, #6485d9 100%);
            "
          >
            <div>
              <h2>PHá»¤ KIá»†N CHÃNH HÃƒNG</h2>
              <p>Báº£o vá»‡ â€“ Vá»› â€“ TÃºi â€“ BÃ¬nh nÆ°á»›c â€“ GiÃ¡ tá»‘t má»—i ngÃ y</p>
            </div>
          </div>
        </div>
        <div class="dots" aria-hidden="true"></div>
      </div>
      <div class="promo">
        <div class="card">
          <h3>Combo GiÃ y + Vá»›</h3>
          <small>Mua combo tiáº¿t kiá»‡m thÃªm 10%</small>
        </div>
        <div class="card">
          <h3>Voucher thÃ nh viÃªn</h3>
          <small>ÄÄƒng kÃ½ nháº­n ngay mÃ£ -30K</small>
        </div>
      </div>
    </section>
    <div class="toolbar" id="toolbar">
      <div class="filters">
        <button class="chip active" data-chip="all">Táº¥t cáº£</button>
        <button class="chip" data-chip="sale">Äang giáº£m giÃ¡</button>
        <button class="chip" data-chip="moi">HÃ ng má»›i</button>
        <button class="chip" data-chip="<1000">DÆ°á»›i 1triá»‡u</button>
        <button class="chip" data-chip=">=1000">Tá»« 1triá»‡u</button>
      </div>
      <select class="sort" id="sortSelect" aria-label="Sáº¯p xáº¿p">
        <option value="popular">Phá»• biáº¿n</option>
        <option value="price-asc">GiÃ¡ tÄƒng dáº§n</option>
        <option value="price-desc">GiÃ¡ giáº£m dáº§n</option>
        <option value="newest">Má»›i nháº¥t</option>
      </select>
    </div>
    <!-- TRANG CHI TIáº¾T Sáº¢N PHáº¨M (hash router) -->
    <section id="detailView" hidden>
      <div class="detail">
        <div class="card" id="detailGallery">
          <a href="#" class="backlink">â¬… Quay láº¡i</a>
          <div
            style="
              width: 100%;
              aspect-ratio: 1/1;
              border-radius: 12px;
              background: #0b1328;
              display: grid;
              place-items: center;
              border: 1px solid var(--stroke);
              margin-top: 8px;
            "
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              style="width: 96px; height: 96px; color: #e2e8f0"
            >
              <circle cx="12" cy="12" r="10" />
              <path
                d="M2 12h20M12 2v20M4 4l4 4M20 4l-4 4M4 20l4-4M20 20l-4-4"
              />
            </svg>
          </div>
        </div>
        <div class="card">
          <div id="detailBrand" class="brand"></div>
          <div id="detailTitle" class="title"></div>
          <div class="price" style="margin-left: -2px">
            <span id="detailPrice" class="new"></span>
            <span id="detailOld" class="old"></span>
          </div>
          <div style="margin-top: 16px">
            <div style="font-weight: 700; margin-bottom: 8px">Chá»n size</div>
            <div id="sizeGroup" class="size-group"></div>
            <div
              id="sizeHint"
              style="margin-top: 8px; font-size: 13px; color: #6b7280"
            ></div>
          </div>
          <div class="qty-row">
            <span style="min-width: 72px">Sá»‘ lÆ°á»£ng</span>
            <button id="minusBtn" aria-label="Giáº£m">-</button>
            <span id="qtyDisplay">1</span>
            <button id="plusBtn" aria-label="TÄƒng">+</button>
          </div>
          <div
            style="
              display: grid;
              grid-template-columns: 1fr;
              gap: 10px;
              margin-top: 16px;
            "
          >
            <button id="addToCartDetail" class="btn-primary" disabled>
              ThÃªm vÃ o giá»
            </button>
            <button id="buyNowBtn" class="btn-outline" disabled>
              Mua ngay
            </button>
          </div>
          <div
            id="detailMeta"
            style="margin-top: 12px; font-size: 13px; color: #6b7280"
          ></div>
        </div>
      </div>
    </section>
    <!-- LÆ°á»›i sáº£n pháº©m -->
    <section
      class="products"
      id="productGrid"
      aria-label="Danh sÃ¡ch sáº£n pháº©m"
    ></section>
    <!-- Drawer giá» hÃ ng -->
    <aside
      class="cart-drawer"
      id="cartDrawer"
      aria-label="Giá» hÃ ng"
      aria-hidden="true"
    >
      <div
        class="cart-head"
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
        "
      >
        <strong>Giá» hÃ ng</strong>
        <button class="btn-outline" id="closeCart">ÄÃ³ng</button>
      </div>
      <div class="cart-items" id="cartItems"></div>
      <div class="cart-foot">
        <div
          style="
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
          "
        >
          <span>Táº¡m tÃ­nh</span> <strong id="subtotal">0â‚«</strong>
        </div>
        <button class="btn-primary" style="width: 100%" id="checkoutBtn">
          Thanh toÃ¡n
        </button>
      </div>
    </aside>
    <footer>
      <div class="footer-inner">
        <div class="ft-col">
          <h4>LT SPORT STORE</h4>
          <p>
            Há»‡ thá»‘ng cá»­a hÃ ng Ä‘á»“ thá»ƒ thao â€“ chuyÃªn giÃ y, Ã¡o Ä‘áº¥u & phá»¥ kiá»‡n. Cam
            káº¿t chÃ­nh hÃ£ng, Ä‘á»•i size trong 7 ngÃ y.
          </p>
          <div class="newsletter">
            <input placeholder="Nháº­p email Ä‘á»ƒ nháº­n Æ°u Ä‘Ã£i" /><button
              class="btn-primary"
            >
              ÄÄƒng kÃ½
            </button>
          </div>
        </div>
        <div class="ft-col">
          <h4>LiÃªn há»‡</h4>
          <p>
            Hotline: 0988 888 888<br />Email: support@LTStore.vn<br />CSKH:
            8:00 â€“ 22:00
          </p>
        </div>
        <div class="ft-col">
          <h4>ChÃ­nh sÃ¡ch</h4>
          <p>
            Giao hÃ ng & Äá»•i tráº£<br />Báº£o hÃ nh & HÆ°á»›ng dáº«n sá»­ dá»¥ng<br />Thanh
            toÃ¡n & Báº£o máº­t
          </p>
        </div>
      </div>
    </footer>
   <script th:src="@{/client/js/home/index.js}"></script>
    <script>
Â  Â  Â  document.addEventListener("DOMContentLoaded", async function () {

Â  Â  try {
Â  Â  Â  Â  // Gá»­i má»™t request Ä‘á»ƒ "kiá»ƒm tra" server
Â  Â  Â  Â  const response = await fetch('/api/auth/me');

Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  // Server tráº£ vá» OK, nghÄ©a lÃ  session VáºªN CÃ’N
Â  Â  Â  Â  Â  Â  const user = await response.json();

Â 
Â  Â  Â  Â  Â  Â  const username = user.tenDangNhap || user.username || user.ten_dang_nhap;
Â  Â  Â  Â  Â  Â  const hoTen = user.hoTen || user.ho_ten;

Â  Â  Â  Â  Â  Â  if (!hoTen) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("KhÃ´ng tÃ¬m tháº¥y 'hoTen' hay 'ho_ten' trong user object:", user);
Â  Â  Â  Â  Â  Â  Â  Â  sessionStorage.clear();
Â  Â  Â  Â  Â  Â  Â  Â  renderLoginButton();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Cáº­p nháº­t láº¡i sessionStorage cho cháº¯c
Â  Â  Â  Â  Â  Â  sessionStorage.setItem("username", username); 
Â  Â  Â  Â  Â  Â  sessionStorage.setItem("ho_ten", hoTen);

Â  Â  Â  Â  Â  Â  // Gá»i hÃ m hiá»ƒn thá»‹ menu user
Â  Â  Â  Â  Â  Â  renderUserMenu(hoTen);

Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Server tráº£ vá» lá»—i (vÃ­ dá»¥ 401), nghÄ©a lÃ  session ÄÃƒ Máº¤T
Â  Â  Â  Â  Â  Â  // ÄÃ¢y lÃ  trÆ°á»ng há»£p server vá»«a restart
Â  Â  Â  Â  Â  Â  sessionStorage.clear(); // XÃ³a sáº¡ch thÃ´ng tin cÅ© á»Ÿ client
Â  Â  Â  Â  Â  Â  renderLoginButton(); // Hiá»ƒn thá»‹ láº¡i nÃºt Login
Â  Â  Â  Â  }

Â  Â  } catch (error) {
Â  Â  Â  Â  // CÃ³ lá»—i (vÃ­ dá»¥ server táº¯t háº³n), cÅ©ng coi nhÆ° Ä‘Ã£ Ä‘Äƒng xuáº¥t
Â  Â  Â  Â  console.error("KhÃ´ng thá»ƒ káº¿t ná»‘i server:", error);
Â  Â  Â  Â  sessionStorage.clear();
Â  Â  Â  Â  renderLoginButton();
Â  Â  }
});

// HÃ m váº½ menu user
function renderUserMenu(hoTen) {
Â  Â  const loginBtn = document.getElementById("loginBtn");
Â  Â  if (!loginBtn) return; // Náº¿u Ä‘Ã£ cÃ³ menu rá»“i thÃ¬ thÃ´i

 loginBtn.outerHTML = `
<div class="user-menu-container">
 <div id="userMenuTrigger" class="user-menu-trigger">
 <span>ğŸ‘¤ Xin chÃ o, <strong>${hoTen}</strong></span>
<span class="dropdown-arrow">â–¼</span>
 </div>
 <div id="userDropdownMenu" class="dropdown-menu">
 <a href="/profile">ThÃ´ng tin cÃ¡ nhÃ¢n</a>
<a href="/cart">Giá» hÃ ng</a>
 <a href="#" id="logoutBtn">ÄÄƒng xuáº¥t</a>
 </div>
 </div>`;

Â  
Â  Â  addMenuListeners(); // Gáº¯n láº¡i event cho menu má»›i
}

// ==========================================================
// Sá»¬A Lá»–I 2: VIáº¾T CODE CHO HÃ€M RENDER NÃšT LOGIN
// ==========================================================
function renderLoginButton() {
    // TÃ¬m container (cÃ³ thá»ƒ nÃ³ Ä‘ang lÃ  menu user)
Â  Â  const menuContainer = document.querySelector(".user-menu-container");

    // Náº¿u tÃ¬m tháº¥y menu (tá»©c lÃ  user Cáº¦N logout) -> thay tháº¿ nÃ³
    if(menuContainer) {
        menuContainer.outerHTML = `
            <div id="loginBtn" class="login-icon">
        <imgsrc="https://th.bing.com/th/id/R.f58bd7f73934e1145c97570943087ec6?rik=41HmRGohn%2fnBJg&riu=http%3a%2f%2fwww.acsoft.vn%3a8081%2fresources%2fimages%2favatar.jpg&ehk=4oftGWjeo8XsGu%2fcHG2dUJubsKryVLuNa58H9D3TNKA%3d&risl=&pid=ImgRaw&r=0"
          alt="user"
          />
        <span class="notify-dot"></span>
        </div>
        `;
    }
    
    // Gáº¯n event click cho nÃºt login (dÃ¹ lÃ  má»›i hay cÅ©)
    const loginBtn = document.getElementById("loginBtn");
    if(loginBtn) {
        loginBtn.addEventListener("click", () => {
            window.location.href = "/login";
        });
    }
}


function addMenuListeners() {
Â  Â  const menuTrigger = document.getElementById("userMenuTrigger");
Â  Â  const dropdownMenu = document.getElementById("userDropdownMenu");
    const logoutBtn = document.getElementById("logoutBtn");

Â  Â  if (menuTrigger && dropdownMenu) {
Â  Â  Â  Â  menuTrigger.addEventListener("click", (event) => {
Â  Â  Â  Â  Â  Â  event.stopPropagation();
Â  Â  Â  Â  Â  Â  dropdownMenu.classList.toggle("show");
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // ÄÃ³ng menu khi click ra ngoÃ i
Â  Â  window.addEventListener("click", (e) => {
        // Pháº£i kiá»ƒm tra menuTrigger cÃ³ tá»“n táº¡i khÃ´ng
Â  Â  Â  Â  if (menuTrigger && dropdownMenu && dropdownMenu.classList.contains("show") && !menuTrigger.contains(e.target)) {
Â  Â  Â  Â  Â  Â  Â dropdownMenu.classList.remove("show");
Â  Â  Â  Â  }
Â  Â  });

Â  
Â  Â  if (logoutBtn) {
Â  Â  Â  Â  logoutBtn.addEventListener("click", async (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
            try {
                await fetch('/logout', { method: 'POST' }); 
            } catch (err) {
                console.error("Lá»—i gá»i API logout, nhÆ°ng váº«n tiáº¿n hÃ nh logout client", err);
            } finally {
                sessionStorage.clear();
    Â  Â  Â  Â  Â  Â  window.location.reload();
            }
Â  Â  Â  Â  });
Â  Â  }
}
Â  Â  </script>


  </body>
</html>

