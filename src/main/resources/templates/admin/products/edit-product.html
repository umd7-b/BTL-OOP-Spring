<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch·ªânh s·ª≠a s·∫£n ph·∫©m</title>
    <link rel="stylesheet" th:href="@{/admin/css/products/index.css}">
        <style>
        .variants-section {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .variants-section h3 {
            margin-bottom: 15px;
            color: #333;
        }
        #variantsTable {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
            background: white;
        }
        #variantsTable th {
            background: #f1f3f5;
            padding: 12px;
            text-align: left;
            border: 1px solid #dee2e6;
            font-weight: 600;
        }
        #variantsTable td {
            padding: 10px;
            border: 1px solid #dee2e6;
        }
        #variantsTable input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        .btn-add-variant {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        .btn-add-variant:hover {
            background: #218838;
        }
        .btn-remove-variant {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-remove-variant:hover {
            background: #c82333;
        }
    </style>


</head>


<body>
<div class="container">


    <!-- Sidebar -->
   <div class="sidebar">
    <div class="logo">
        <h2>üéØ Admin Panel</h2>
    </div>
    <div class="menu-item" th:onclick="|window.location.href='@{/admin/dashboard}'|">
        <i>üìä</i>
        <span>Dashboard</span>
    </div>
    <div class="menu-item" th:onclick="|window.location.href='@{/admin/users}'|">
        <i>üë•</i>
        <span>Ng∆∞·ªùi d√πng</span>
    </div>
    <div class="menu-item active" th:onclick="|window.location.href='@{/admin/products}'|">
        <i>üì¶</i>
        <span>S·∫£n ph·∫©m</span>
    </div>
    <div class="menu-item" th:onclick="|window.location.href='@{/admin/orders}'|">
        <i>üõí</i>
        <span>ƒê∆°n h√†ng</span>
    </div>
    <div class="menu-item" th:onclick="|window.location.href='@{/admin/analytics}'|">
        <i>üìà</i>
        <span>Th·ªëng k√™</span>
    </div>
    <div class="menu-item" th:onclick="|window.location.href='@{/admin/settings}'|">
        <i>‚öôÔ∏è</i>
        <span>C√†i ƒë·∫∑t</span>
    </div>
</div>


    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h1>Ch·ªânh s·ª≠a s·∫£n ph·∫©m</h1>
        </div>


        <div class="content">


            <div class="form-card">


               <form th:action="@{|/admin/products/update/${product.maSp}|}"
      method="post"
      enctype="multipart/form-data">


                <div th:if="${success}"
     style="padding:12px;background:#d4edda;color:#155724;border-radius:6px;margin-bottom:15px;">
    <strong th:text="${success}"></strong>
</div>






                    <!-- ID SP -->
                    <input type="hidden" th:value="${product.maSp}" name="maSp"/>


                    <!-- T√™n SP -->
                    <div class="form-group">
                        <label>T√™n s·∫£n ph·∫©m</label>
                        <input type="text" name="tenSp" th:value="${product.tenSp}" required>
                    </div>


                    <!-- Gi√° g·ªëc -->
                    <div class="form-group">
                        <label>Gi√° g·ªëc</label>
                        <input type="number" name="giaGoc" th:value="${product.giaGoc}" required>
                    </div>


                    <!-- Gi√° KM -->
                    <div class="form-group">
                        <label>Gi√° khuy·∫øn m√£i</label>
                        <input type="number" name="giaKm" th:value="${product.giaKm}">
                    </div>


                    <!-- Th∆∞∆°ng hi·ªáu -->
                    <div class="form-group">
                        <label>Th∆∞∆°ng hi·ªáu</label>
                        <select name="thuongHieu.maThuongHieu" required>
                            <option th:each="b : ${brands}"
                                    th:value="${b.maThuongHieu}"
                                    th:selected="${b.maThuongHieu == product.thuongHieu?.maThuongHieu}"
                                    th:text="${b.tenThuongHieu}">
                            </option>
                        </select>
                    </div>


                    <!-- Danh m·ª•c -->
                    <div class="form-group">
                        <label>Danh m·ª•c</label>
                        <select name="danhMuc.maDanhMuc" required>
                            <option th:each="c : ${categories}"
                                    th:value="${c.maDanhMuc}"
                                    th:selected="${c.maDanhMuc == product.danhMuc?.maDanhMuc}"
                                    th:text="${c.tenDanhMuc}">
                            </option>
                        </select>
                    </div>


                    <!-- M√¥n th·ªÉ thao -->
                    <div class="form-group">
                        <label>M√¥n th·ªÉ thao</label>
                        <select name="monTheThao.maMonTheThao" required>
                            <option th:each="s : ${sports}"
                                    th:value="${s.maMonTheThao}"
                                    th:selected="${s.maMonTheThao == product.monTheThao?.maMonTheThao}"
                                    th:text="${s.tenMonTheThao}">
                            </option>
                        </select>
                    </div>




                    <div class="variants-section">
                        <h3>üìè Bi·∫øn th·ªÉ s·∫£n ph·∫©m</h3>
                        <button type="button" class="btn-add-variant" onclick="addVariantRow()">
                            + Th√™m bi·∫øn th·ªÉ
                        </button>


                        <table id="variantsTable">
                            <thead>
                                <tr>
                                    <th>M√†u s·∫Øc</th>
                                    <th>K√≠ch th∆∞·ªõc</th>
                                    <th>S·ªë l∆∞·ª£ng t·ªìn</th>
                                    <th>X√≥a</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Hi·ªÉn th·ªã c√°c bi·∫øn th·ªÉ hi·ªán c√≥ -->
                                <tr th:each="variant, iterStat : ${product.bienThe}">
                                    <input type="hidden"
                                           th:name="|bienThe[${iterStat.index}].maBienThe|"
                                           th:value="${variant.maBienThe}"/>
                                   
                                    <td>
                                        <input type="text"
                                               th:name="|bienThe[${iterStat.index}].mauSac|"
                                               th:value="${variant.mauSac}"
                                               class="input-mau-sac"
                                               required/>
                                    </td>
                                   
                                    <td>
                                        <input type="text"
                                               th:name="|bienThe[${iterStat.index}].kichThuoc|"
                                               th:value="${variant.kichThuoc}"
                                               class="input-kich-thuoc"
                                               required/>
                                    </td>
                                   
                                    <td>
                                        <input type="number"
                                               th:name="|bienThe[${iterStat.index}].soLuongTon|"
                                               th:value="${variant.soLuongTon}"
                                               class="input-ton-kho"
                                               min="0"
                                               required/>
                                    </td>
                                   
                                    <td style="text-align: center;">
                                        <button type="button" class="btn-remove-variant" onclick="removeVariantRow(this)">
                                            X
                                        </button>
                                    </td>
                                </tr>


                                <!-- N·∫øu ch∆∞a c√≥ bi·∫øn th·ªÉ n√†o, hi·ªÉn th·ªã 1 d√≤ng tr·ªëng -->
                                <tr th:if="${#lists.isEmpty(product.bienThe)}">
                                    <td>
                                        <input type="text"
                                               name="bienThe[0].mauSac"
                                               class="input-mau-sac"
                                               placeholder="V√≠ d·ª•: ƒê·ªè"
                                               required/>
                                    </td>
                                   
                                    <td>
                                        <input type="text"
                                               name="bienThe[0].kichThuoc"
                                               class="input-kich-thuoc"
                                               placeholder="V√≠ d·ª•: M, 39, XL"
                                               required/>
                                    </td>
                                   
                                    <td>
                                        <input type="number"
                                               name="bienThe[0].soLuongTon"
                                               class="input-ton-kho"
                                               value="0"
                                               min="0"
                                               required/>
                                    </td>
                                   
                                    <td style="text-align: center;">
                                        <button type="button" class="btn-remove-variant" onclick="removeVariantRow(this)">
                                            X
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>










                    <!-- ·∫¢nh hi·ªán t·∫°i -->
                    <div class="form-group">
                        <label>·∫¢nh hi·ªán t·∫°i</label>
                        <div class="image-preview-container">


                            <div th:each="img : ${product.danhSachAnh}">
                                <img th:src="@{'/uploads/products/' + ${img.linkAnh}}"
                                     style="width:80px;height:80px;object-fit:cover;border-radius:6px;margin-right:10px;">
                            </div>


                            <div th:if="${#lists.isEmpty(product.danhSachAnh)}">
                                <p>Kh√¥ng c√≥ ·∫£nh</p>
                            </div>


                        </div>
                    </div>


                    <!-- Upload ·∫£nh m·ªõi -->
                    <div class="form-group">
                        <label>Th√™m ·∫£nh m·ªõi</label>
                        <input type="file" name="anhSanPham" multiple accept="image/*">
                    </div>


                    <!-- N√∫t -->
                    <div class="modal-actions">
                        <a href="/admin/products/list" class="btn btn-secondary">‚¨Ö Quay l·∫°i</a>


                        <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t</button>
                    </div>




                </form>


            </div>
        </div>
    </div>
</div>


<script>
    /**
     * Th√™m m·ªôt h√†ng bi·∫øn th·ªÉ m·ªõi v√†o b·∫£ng
     */
    function addVariantRow() {
        const tbody = document.getElementById('variantsTable').getElementsByTagName('tbody')[0];
       
        // L·∫•y index m·ªõi b·∫±ng s·ªë l∆∞·ª£ng h√†ng hi·ªán t·∫°i
        // ƒêi·ªÅu n√†y quan tr·ªçng ƒë·ªÉ Spring Boot c√≥ th·ªÉ nh·∫≠n m·∫£ng: bienThe[0], bienThe[1], ...
        const newIndex = tbody.rows.length;


        // T·∫°o h√†ng (tr) v√† c√°c √¥ (td) m·ªõi
        const newRow = tbody.insertRow();
        newRow.innerHTML = `
            <input type="hidden" name="bienThe[${newIndex}].maBienThe" value="" />
           
            <td>
                <input type="text"
                       name="bienThe[${newIndex}].mauSac"
                       class="input-mau-sac"
                       placeholder="V√≠ d·ª•: ƒê·ªè"
                       required/>
            </td>
           
            <td>
                <input type="text"
                       name="bienThe[${newIndex}].kichThuoc"
                       class="input-kich-thuoc"
                       placeholder="V√≠ d·ª•: M, 39, XL"
                       required/>
            </td>
           
            <td>
                <input type="number"
                       name="bienThe[${newIndex}].soLuongTon"
                       class="input-ton-kho"
                       value="0"
                       min="0"
                       required/>
            </td>
           
            <td style="text-align: center;">
                <button type="button" class="btn-remove-variant" onclick="removeVariantRow(this)">
                    X
                </button>
            </td>
        `;
    }


    /**
     * X√≥a m·ªôt h√†ng bi·∫øn th·ªÉ v√† c·∫≠p nh·∫≠t l·∫°i ch·ªâ s·ªë (index) c·ªßa c√°c h√†ng c√≤n l·∫°i
     */
    function removeVariantRow(button) {
        // L·∫•y h√†ng `tr` cha g·∫ßn nh·∫•t v√† x√≥a n√≥
        const rowToRemove = button.closest('tr');
        rowToRemove.remove();
       
        // C·∫≠p nh·∫≠t l·∫°i index c·ªßa t·∫•t c·∫£ c√°c h√†ng c√≤n l·∫°i
        updateRowIndexes();
    }


    /**
     * C·∫≠p nh·∫≠t l·∫°i thu·ªôc t√≠nh 'name' cho c√°c input ƒë·ªÉ ƒë·∫£m b·∫£o index li√™n t·ª•c
     * (vd: bienThe[0], bienThe[1], bienThe[2]...)
     */
    function updateRowIndexes() {
        const tbody = document.getElementById('variantsTable').getElementsByTagName('tbody')[0];
        const rows = tbody.querySelectorAll('tr');
       
        rows.forEach((row, index) => {
            // T√¨m t·∫•t c·∫£ input, select... b√™n trong h√†ng n√†y
            row.querySelectorAll('input').forEach(input => {
                const oldName = input.getAttribute('name');
                if (oldName) {
                    // Thay th·∫ø index c≈© b·∫±ng index m·ªõi
                    // V√≠ d·ª•: "bienThe[2].mauSac" -> "bienThe[0].mauSac"
                    const newName = oldName.replace(/\[\d+\]/, `[${index}]`);
                    input.setAttribute('name', newName);
                }
            });
        });
    }
</script>






</body>
</html>



